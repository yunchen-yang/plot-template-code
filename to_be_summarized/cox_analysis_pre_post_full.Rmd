---
title: Survival and recurrence cox-analysis of exosomal microRNA biomarkers
author: "Yunchen Yang"
date: "7/31/2020"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = "hide", message=FALSE, warning=FALSE)
options(digits = 15)
```

# 1. Read and preprocess raw data.
## Import libraries and read raw data from '.xlsx' file..
```{r}
library("survival")
library("survminer")
library("gdata")
df <- read.xls('./r_analysis.xlsx', sheet=1, na.strings=c("NA", "#DIV/0!"))

unianalysis <- function(argname, taskname, dfname='df', discrete=FALSE){
  if (taskname == 'survival'){
    formula.str <- paste0('Surv(', dfname, '$', taskname, ', ', dfname, '$status_mat) ~ ', argname)
  } else {
    formula.str <- paste0('Surv(', dfname, '$', taskname, ', ', dfname, '$reoccur_mat) ~ ', argname)
  }
  res.cox <- coxph(as.formula(formula.str), data = get(dfname))
  hr <- summary(res.cox)$conf.int[1]
  hr.lower <- summary(res.cox)$conf.int[3]
  hr.upper <- summary(res.cox)$conf.int[4]
  if (discrete){
    p.value <- summary(res.cox)$sctest[3]
    sfit <- survfit(as.formula(formula.str), data = get(dfname))
    ref.surv <- summary(sfit, times=60)$surv[1]
    ref.lower <- summary(sfit, times=60)$lower[1]
    ref.upper <- summary(sfit, times=60)$upper[1]
    exp.surv <- summary(sfit, times=60)$surv[2]
    exp.lower <- summary(sfit, times=60)$lower[2]
    exp.upper <- summary(sfit, times=60)$upper[2]
  } else {
    p.value <- summary(res.cox)$coefficients[5]
    ref.surv <- NULL
    ref.lower <- NULL
    ref.upper <- NULL
    exp.surv <- NULL
    exp.lower <- NULL
    exp.upper <- NULL
  }
  return(c(p.value, hr, hr.lower, hr.upper, ref.surv, ref.lower, ref.upper, exp.surv, exp.lower, exp.upper))
}

```
## Convert string formatted labels into numeric tags.
```{r, results='markup'}
df$gender_mat <- as.numeric(sub("F","0",sub("M","1",df$Gender)))
df$location_mat <- as.numeric(sub("Right","0",sub("Left","1",df$LATERAL)))
df$smoker_mat <- as.numeric(sub("Nonsmoker", "0", sub("Former","0", sub("Current","1",df$Smoker))))
df$grade_mat <- as.numeric(sub("Well differentiated", "1", sub("Moderately differentiated","1", sub("Poorly differentiated","0",df$Grade))))
df$status_mat <- as.numeric(sub("lost follow up", "0", sub("Alive","0", sub("Dead","1",df$Post.status))))
df$reoccur_status_mat <- as.numeric(sub("No","0",sub("Yes","1",df$Reoccur.status)))
df$reoccur_mat <- df$reoccur_status_mat
df$reoccur_mat[df$status_mat==1|df$reoccur_status_mat==1]=1
df$all <- 1
```
## Convert expressions of biomarkers into Z-scores.
```{r, results='markup'}
df$bio21.pre.z <- scale(df$Biosensor.miR.21.pre)
df$bio486.pre.z <- scale(df$Biosensor.miR.486.pre)
df$bio24.pre.z <- scale(df$Biosensor.miR.24.pre)
df$bio30d.pre.z <- scale(df$Biosensor.miR.30d.pre)
df$bio21.post6.z <- scale(df$Biosensor.miR.21.post.6.months)
df$bio486.post6.z <- scale(df$Biosensor.miR.486.post.6.months)
df$bio24.post6.z <- scale(df$Biosensor.miR.24.post.6.months)
df$bio30d.post6.z <- scale(df$Biosensor.miR.30d.post.6.months)
df$bio21.fc.z0.6 <- scale(log(df$Biosensor.miR.21.post.6.months/df$Biosensor.miR.21.pre,2))
df$bio486.fc.z0.6 <- scale(log(df$Biosensor.miR.486.post.6.months/df$Biosensor.miR.486.pre,2))
df$bio24.fc.z0.6 <- scale(log(df$Biosensor.miR.24.post.6.months/df$Biosensor.miR.24.pre,2))
df$bio30d.fc.z0.6 <- scale(log(df$Biosensor.miR.30d.post.6.months/df$Biosensor.miR.30d.pre,2))
df$bio21.diff.z0.6 <- scale(df$Biosensor.miR.21.post.6.months - df$Biosensor.miR.21.pre)
df$bio486.diff.z0.6 <- scale(df$Biosensor.miR.486.post.6.months - df$Biosensor.miR.486.pre)
df$bio24.diff.z0.6 <- scale(df$Biosensor.miR.24.post.6.months - df$Biosensor.miR.24.pre)
df$bio30d.diff.z0.6 <- scale(df$Biosensor.miR.30d.post.6.months - df$Biosensor.miR.30d.pre)

df$pcr21.pre.z <- scale(-df$qPCR.miR.21.pre)
df$pcr486.pre.z <- scale(-df$qPCR.miR.486.pre)
df$pcr24.pre.z <- scale(-df$qPCR.miR.24.pre)
df$pcr30d.pre.z <- scale(-df$qPCR.miR.30d.pre)
df$pcr21.post6.z <- scale(-df$qPCR.miR.21.post.6.months)
df$pcr486.post6.z <- scale(-df$qPCR.miR.486.post.6.months)
df$pcr24.post6.z <- scale(-df$qPCR.miR.24.post.6.months)
df$pcr30d.post6.z <- scale(-df$qPCR.miR.30d.post.6.months)
df$pcr21.diff.z0.6 <- scale(df$qPCR.miR.21.pre - df$qPCR.miR.21.post.6.months)
df$pcr486.diff.z0.6 <- scale(df$qPCR.miR.486.pre - df$qPCR.miR.486.post.6.months)
df$pcr24.diff.z0.6 <- scale(df$qPCR.miR.24.pre - df$qPCR.miR.24.post.6.months)
df$pcr30d.diff.z0.6 <- scale(df$qPCR.miR.30d.pre - df$qPCR.miR.30d.post.6.months)

# df$pcr21.pre.z <- df$qPCR.miR.21.pre
# df$pcr486.pre.z <- df$qPCR.miR.486.pre
# df$pcr24.pre.z <- df$qPCR.miR.24.pre
# df$pcr30d.pre.z <- df$qPCR.miR.30d.pre
# df$pcr21.post6.z <- df$qPCR.miR.21.post.6.months
# df$pcr486.post6.z <- df$qPCR.miR.486.post.6.months
# df$pcr24.post6.z <- df$qPCR.miR.24.post.6.months
# df$pcr30d.post6.z <- df$qPCR.miR.30d.post.6.months
# df$pcr21.diff.z0.6 <- df$qPCR.miR.21.pre - df$qPCR.miR.21.post.6.months
# df$pcr486.diff.z0.6 <- df$qPCR.miR.486.pre - df$qPCR.miR.486.post.6.months
# df$pcr24.diff.z0.6 <- df$qPCR.miR.24.pre - df$qPCR.miR.24.post.6.months
# df$pcr30d.diff.z0.6 <- df$qPCR.miR.30d.pre - df$qPCR.miR.30d.post.6.months
```
## Check the covariance matrix.
```{r, results='markup'}
cov <- var(df[c('bio21.pre.z', 'bio21.post6.z', 'bio486.pre.z', 'bio486.post6.z', 'bio24.pre.z', 'bio24.post6.z', 'bio30d.pre.z', 'bio30d.post6.z', 'bio21.diff.z0.6', 'bio486.diff.z0.6', 'bio24.diff.z0.6', 'bio30d.diff.z0.6', 'bio21.fc.z0.6', 'bio486.fc.z0.6', 'bio24.fc.z0.6', 'bio30d.fc.z0.6')])
cov
```
# 2. Overall Survival analysis and recurrence analysis (pre-treatment and 6-months' post-treatment)
## 2.1. Overall Survival analysis
### Plot KM survival curves.
```{r}
fit <- survfit(Surv(df$survival, df$status_mat) ~ gender_mat, data=df)
p <- ggsurvplot(fit, xlab = "Follow up time (Months)",
                conf.int = TRUE, 
                pval=paste0('Log-rank\np = ', round(surv_pvalue(fit)$pval,4)),
                ylim = c(0.25, 1),
                pval.coord=c(10,0.5),
                legend.labs=c("Female","Male"),
                font.tickslab = c(16),
                legend.title="Gender",
                ggtheme = theme_classic2(base_size=16, base_family = "Arial"),
                font.family = "Arial"
)
ggpar(p, 
      font.main = c(16, "bold", "black"),
      font.submain = c(16, "bold", "black"),
      font.subtitle = c(16, "bold", "black"),
      font.x = c(16, "bold", "black"),
      font.y = c(16, "bold", "black"),
      font.caption = c(16, "bold", "black"), 
      font.legend = c(16, "bold", "black"), 
      font.tickslab = c(16, "bold", "black"),
      legend = 'top')

fit <- survfit(Surv(df$survival, df$status_mat) ~ location_mat, data=df)
p <- ggsurvplot(fit, xlab = "Follow up time (Months)",
                conf.int = TRUE, 
                pval=paste0('Log-rank\np = ', round(surv_pvalue(fit)$pval,4)),
                ylim = c(0.25, 1),
                pval.coord=c(10,0.5),
                legend.labs=c("Right","left"),
                font.tickslab = c(16),
                legend.title="Lateral",
                ggtheme = theme_classic2(base_size=16, base_family = "Arial"),
                font.family = "Arial"
)
ggpar(p, 
      font.main = c(16, "bold", "black"),
      font.submain = c(16, "bold", "black"),
      font.subtitle = c(16, "bold", "black"),
      font.x = c(16, "bold", "black"),
      font.y = c(16, "bold", "black"),
      font.caption = c(16, "bold", "black"), 
      font.legend = c(16, "bold", "black"), 
      font.tickslab = c(16, "bold", "black"),
      legend = 'top')

fit <- survfit(Surv(df$survival, df$status_mat) ~ smoker_mat, data=df)
p <- ggsurvplot(fit, xlab = "Follow up time (Months)",
                conf.int = TRUE, 
                pval=paste0('Log-rank\np = ', round(surv_pvalue(fit)$pval,4)),
                ylim = c(0.25, 1),
                pval.coord=c(10,0.5),
                legend.labs=c("Former smokers\n/Non-smokers","Current\nsmokers"),
                font.tickslab = c(16),
                legend.title="Smoking",
                ggtheme = theme_classic2(base_size=16, base_family = "Arial"),
                font.family = "Arial"
)
ggpar(p, 
      font.main = c(16, "bold", "black"),
      font.submain = c(16, "bold", "black"),
      font.subtitle = c(16, "bold", "black"),
      font.x = c(16, "bold", "black"),
      font.y = c(16, "bold", "black"),
      font.caption = c(16, "bold", "black"), 
      font.legend = c(16, "bold", "black"), 
      font.tickslab = c(16, "bold", "black"),
      legend = 'top')

fit <- survfit(Surv(df$survival, df$status_mat) ~ grade_mat, data=df)
p <- ggsurvplot(fit, xlab = "Follow up time (Months)",
                conf.int = TRUE, 
                pval=paste0('Log-rank\np = ', round(surv_pvalue(fit)$pval,4)),
                ylim = c(0.25, 1),
                pval.coord=c(10,0.5),
                legend.labs=c("Poorly\ndifferentiated","Moderately/Well\ndifferentiated"),
                font.tickslab = c(16),
                legend.title="Grade",
                ggtheme = theme_classic2(base_size=16, base_family = "Arial"),
                font.family = "Arial"
)
ggpar(p, 
      font.main = c(16, "bold", "black"),
      font.submain = c(16, "bold", "black"),
      font.subtitle = c(16, "bold", "black"),
      font.x = c(16, "bold", "black"),
      font.y = c(16, "bold", "black"),
      font.caption = c(16, "bold", "black"), 
      font.legend = c(16, "bold", "black"), 
      font.tickslab = c(16, "bold", "black"),
      legend = 'top')
```

### 2.1.1. Univariate analysis of Biomarkers
#### Overall survival
```{r, results='markup'}
sfit <- survfit(Surv(df$survival, df$status_mat==1) ~ all, data = df)
sprintf("5-Year Survival %% (95%% CI): %.4f (%.4f, %.4f)", summary(sfit, times=60)$surv[1], summary(sfit, times=60)$lower[1], summary(sfit, times=60)$upper[1])
```
#### Clinical characteristics
```{r, results='markup'}
variates <- c('gender_mat', 'smoker_mat', 'grade_mat', 'location_mat', 
             'Age.at.surgery', 'Largest.dimension..cm.')
discrete <- c(TRUE, TRUE, TRUE, TRUE, FALSE, FALSE)
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
survr.5yr <- vector()
for(i in 1:length(variates)) {
  res <- unianalysis(variates[i], 'survival', discrete=discrete[i])
  p.value <- res[1]
  hr <- paste0(round(res[2],2), '(', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
  if (discrete[i]) {
    surv.rate <- paste0('Ref: ', round(res[5],5), ' (', round(res[6],5), ', ', round(res[7],5), '); ', 
                        'Exp: ', round(res[8],5), ' (', round(res[9],5), ', ', round(res[10],5), '). ')
  } else {
    surv.rate <- 'NA'
  }
  survr.5yr <- c(survr.5yr, surv.rate)
}
results <- data.frame(variates, p.values, hr.strs, survr.5yr, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs', 'survr.5yr')]
```
#### Biomarkers
```{r, results='markup'}
variates = c('bio21.pre.z', 'bio21.post6.z', 'bio486.pre.z', 'bio486.post6.z', 
             'bio24.pre.z', 'bio24.post6.z', 'bio30d.pre.z', 'bio30d.post6.z', 
             'pcr21.pre.z', 'pcr21.post6.z', 'pcr486.pre.z', 'pcr486.post6.z', 
             'pcr24.pre.z', 'pcr24.post6.z', 'pcr30d.pre.z', 'pcr30d.post6.z',
             'bio21.fc.z0.6', 'bio486.fc.z0.6', 'bio24.fc.z0.6', 'bio30d.fc.z0.6',
             'pcr21.diff.z0.6', 'pcr486.diff.z0.6', 'pcr24.diff.z0.6', 'pcr30d.diff.z0.6',
             'bio21.diff.z0.6', 'bio486.diff.z0.6', 'bio24.diff.z0.6', 'bio30d.diff.z0.6')
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
for(variate in variates) {
  res <- unianalysis(variate, 'survival')
  p.value <- res[1]
  hr <- paste0(round(res[2],2), ' (', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
}
results <- data.frame(variates, p.values, hr.strs, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs')]
```
### 2.1.2. Multivariate analysis
#### 1) Smoking status + Location + Biosensor measured miR-486 (0 vs 6 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat+bio486.diff.z0.6, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Location: %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ location_mat+bio486.diff.z0.6, data = df)
res.cox.no.location <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio486.diff.z0.6, data = df)
res.cox.no.486 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Smoking status: %.4f\n Location: %.4f\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.location,res.cox)$P[2], anova(res.cox.no.486,res.cox)$P[2]))
```
#### 2) Smoking status + Biosensor measured miR-486 (0 vs 6 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio486.diff.z0.6, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6, data = df)
res.cox.no.486 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Smoking status: %.4f\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.486,res.cox)$P[2]))
```
#### 3) Smoking status + Location + Biosensor measured miR-24 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat+bio24.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Location: %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ location_mat+bio24.post6.z, data = df)
res.cox.no.location <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio24.post6.z, data = df)
res.cox.no.24 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Smoking status: %.4f\n Location: %.4f\n Biosensor measured miR-24 (6 months' post-treatment): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.location,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
#### 4) Smoking status + Location + Biosensor measured miR-30d (pre-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat+bio30d.pre.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Location: %.4f (%.4f, %.4f)\n Biosensor measured miR-30d (pre-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ location_mat+bio30d.pre.z, data = df)
res.cox.no.location <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio30d.pre.z, data = df)
res.cox.no.30 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Smoking status: %.4f\n Location: %.4f\n Biosensor measured miR-30d (pre-treatment): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.location,res.cox)$P[2], anova(res.cox.no.30,res.cox)$P[2]))
```
#### 5) Smoking status + Location + Biosensor measured miR-30d (0 vs 6 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat+bio30d.diff.z0.6, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Location: %.4f (%.4f, %.4f)\n Biosensor measured miR-30d (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ location_mat+bio30d.diff.z0.6, data = df)
res.cox.no.location <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio30d.diff.z0.6, data = df)
res.cox.no.30 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Smoking status: %.4f\n Location: %.4f\n Biosensor measured miR-30d (0 vs 6 months differentiated expressions): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.location,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
#### 6) Smoking status + Location + Biosensor measured miR-486 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat+bio486.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Location: %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ location_mat+bio486.post6.z, data = df)
res.cox.no.location <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio486.post6.z, data = df)
res.cox.no.486 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Smoking status: %.4f\n Location: %.4f\n Biosensor measured miR-24 (6 months' post-treatment): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.location,res.cox)$P[2], anova(res.cox.no.486,res.cox)$P[2]))
```
#### 7) Smoking status + Location + Biosensor measured miR-21 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat+bio21.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Location: %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ location_mat+bio21.post6.z, data = df)
res.cox.no.location <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio21.post6.z, data = df)
res.cox.no.21 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+location_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Smoking status: %.4f\n Location: %.4f\n Biosensor measured miR-21 (6 months' post-treatment): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.location,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
#### 8) Smoking status + Biosensor measured miR-486 (0 vs 6 months differentiated expressions) + Biosensor measured miR-24 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio486.diff.z0.6+bio24.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio24.post6.z, data = df)
res.cox.no.486 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio24.post6.z, data = df)
res.cox.no.24 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio486.diff.z0.6, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Smoking status: %.4f\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions):%.4f\n Biosensor measured miR-24 (6 months' post-treatment): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.486,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
#### 9) Biosensor measured miR-486 (0 vs 6 months differentiated expressions) + Biosensor measured miR-24 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio24.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.486 <- coxph(Surv(df$survival, df$status_mat) ~ bio24.post6.z, data = df)
res.cox.no.24 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f\n Biosensor measured miR-24 (6 months' post-treatment): %.4f", anova(res.cox.no.486,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
## 2.2. Recurrence analysis
### Plot KM survival curves.
```{r}
fit <- survfit(Surv(df$recurrence, df$reoccur_mat) ~ gender_mat, data=df)
p <- ggsurvplot(fit, xlab = "Follow up time (Months)",
                ylab = "Reoccur probability",
                conf.int = TRUE, 
                pval=paste0('Log-rank\np = ', round(surv_pvalue(fit)$pval,4)),
                ylim = c(0.25, 1),
                pval.coord=c(10,0.5),
                legend.labs=c("Female","Male"),
                font.tickslab = c(16),
                legend.title="Gender",
                ggtheme = theme_classic2(base_size=16, base_family = "Arial"),
                font.family = "Arial"
)
ggpar(p, 
      font.main = c(16, "bold", "black"),
      font.submain = c(16, "bold", "black"),
      font.subtitle = c(16, "bold", "black"),
      font.x = c(16, "bold", "black"),
      font.y = c(16, "bold", "black"),
      font.caption = c(16, "bold", "black"), 
      font.legend = c(16, "bold", "black"), 
      font.tickslab = c(16, "bold", "black"),
      legend = 'top')

fit <- survfit(Surv(df$recurrence, df$reoccur_mat) ~ location_mat, data=df)
p <- ggsurvplot(fit, xlab = "Follow up time (Months)",
                ylab = "Reoccur probability",
                conf.int = TRUE, 
                pval=paste0('Log-rank\np = ', round(surv_pvalue(fit)$pval,4)),
                ylim = c(0.25, 1),
                pval.coord=c(10,0.5),
                legend.labs=c("Right","left"),
                font.tickslab = c(16),
                legend.title="Lateral",
                ggtheme = theme_classic2(base_size=16, base_family = "Arial"),
                font.family = "Arial"
)
ggpar(p, 
      font.main = c(16, "bold", "black"),
      font.submain = c(16, "bold", "black"),
      font.subtitle = c(16, "bold", "black"),
      font.x = c(16, "bold", "black"),
      font.y = c(16, "bold", "black"),
      font.caption = c(16, "bold", "black"), 
      font.legend = c(16, "bold", "black"), 
      font.tickslab = c(16, "bold", "black"),
      legend = 'top')

fit <- survfit(Surv(df$recurrence, df$reoccur_mat) ~ smoker_mat, data=df)
p <- ggsurvplot(fit, xlab = "Follow up time (Months)",
                ylab = "Reoccur probability",
                conf.int = TRUE, 
                pval=paste0('Log-rank\np = ', round(surv_pvalue(fit)$pval,4)),
                ylim = c(0.25, 1),
                pval.coord=c(10,0.5),
                legend.labs=c("Former smokers\n/Non-smokers","Current\nsmokers"),
                font.tickslab = c(16),
                legend.title="Smoking",
                ggtheme = theme_classic2(base_size=16, base_family = "Arial"),
                font.family = "Arial"
)
ggpar(p, 
      font.main = c(16, "bold", "black"),
      font.submain = c(16, "bold", "black"),
      font.subtitle = c(16, "bold", "black"),
      font.x = c(16, "bold", "black"),
      font.y = c(16, "bold", "black"),
      font.caption = c(16, "bold", "black"), 
      font.legend = c(16, "bold", "black"), 
      font.tickslab = c(16, "bold", "black"),
      legend = 'top')

fit <- survfit(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat, data=df)
p <- ggsurvplot(fit, xlab = "Follow up time (Months)",
                ylab = "Reoccur probability",
                conf.int = TRUE, 
                pval=paste0('Log-rank\np = ', round(surv_pvalue(fit)$pval,4)),
                ylim = c(0.25, 1),
                pval.coord=c(10,0.5),
                legend.labs=c("Poorly\ndifferentiated","Moderately/Well\ndifferentiated"),
                font.tickslab = c(16),
                legend.title="Grade",
                ggtheme = theme_classic2(base_size=16, base_family = "Arial"),
                font.family = "Arial"
)
ggpar(p, 
      font.main = c(16, "bold", "black"),
      font.submain = c(16, "bold", "black"),
      font.subtitle = c(16, "bold", "black"),
      font.x = c(16, "bold", "black"),
      font.y = c(16, "bold", "black"),
      font.caption = c(16, "bold", "black"), 
      font.legend = c(16, "bold", "black"), 
      font.tickslab = c(16, "bold", "black"),
      legend = 'top')
```

### 2.2.1. Univariate analysis
#### Overall survival
```{r, results='markup'}
sfit <- survfit(Surv(df$recurrence, df$reoccur_mat==1) ~ all, data = df)
sprintf("5-Year Survival %% (95%% CI): %.4f (%.4f, %.4f)", summary(sfit, times=60)$surv[1], summary(sfit, times=60)$lower[1], summary(sfit, times=60)$upper[1])
```
#### Clinical characteristics
```{r, results='markup'}
variates <- c('gender_mat', 'smoker_mat', 'grade_mat', 'location_mat', 
             'Age.at.surgery', 'Largest.dimension..cm.')
discrete <- c(TRUE, TRUE, TRUE, TRUE, FALSE, FALSE)
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
survr.5yr <- vector()
for(i in 1:length(variates)) {
  res <- unianalysis(variates[i], 'recurrence', discrete=discrete[i])
  p.value <- res[1]
  hr <- paste0(round(res[2],2), ' (', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
  if (discrete[i]) {
    surv.rate <- paste0('Ref: ', round(res[5],5), ' (', round(res[6],5), ', ', round(res[7],5), '); ', 
                        'Exp: ', round(res[8],5), ' (', round(res[9],5), ', ', round(res[10],5), '). ')
  } else {
    surv.rate <- 'NA'
  }
  survr.5yr <- c(survr.5yr, surv.rate)
}
results <- data.frame(variates, p.values, hr.strs, survr.5yr, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs', 'survr.5yr')]
```
#### Biomarkers
```{r, results='markup'}
variates = c('bio21.pre.z', 'bio21.post6.z', 'bio486.pre.z', 'bio486.post6.z', 
             'bio24.pre.z', 'bio24.post6.z', 'bio30d.pre.z', 'bio30d.post6.z', 
             'pcr21.pre.z', 'pcr21.post6.z', 'pcr486.pre.z', 'pcr486.post6.z', 
             'pcr24.pre.z', 'pcr24.post6.z', 'pcr30d.pre.z', 'pcr30d.post6.z',
             'bio21.fc.z0.6', 'bio486.fc.z0.6', 'bio24.fc.z0.6', 'bio30d.fc.z0.6',
             'pcr21.diff.z0.6', 'pcr486.diff.z0.6', 'pcr24.diff.z0.6', 'pcr30d.diff.z0.6',
             'bio21.diff.z0.6', 'bio486.diff.z0.6', 'bio24.diff.z0.6', 'bio30d.diff.z0.6')
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
for(variate in variates) {
  res <- unianalysis(variate, 'recurrence')
  p.value <- res[1]
  hr <- paste0(round(res[2],2), ' (', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
}
results <- data.frame(variates, p.values, hr.strs, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs')]
```
### 2.2.2. Multivariate analysis
#### 1) Grade + Biosensor measured miR-24 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat+bio24.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Grade: %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.grade <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z, data = df)
res.cox.no.24 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Grade: %.4f\n Biosensor measured miR-24 (6 months' post-treatment): %.4f", anova(res.cox.no.grade,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
#### 2) Grade + Biosensor measured miR-21 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat+bio21.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Grade: %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.grade <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio21.post6.z, data = df)
res.cox.no.21 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Grade: %.4f\n Biosensor measured miR-21 (6 months' post-treatment): %.4f", anova(res.cox.no.grade,res.cox)$P[2], anova(res.cox.no.21,res.cox)$P[2]))
```
#### 3) Grade + Biosensor measured miR-30d (pre-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat+bio30d.pre.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Grade: %.4f (%.4f, %.4f)\n Biosensor measured miR-30d (pre-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.grade <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio30d.pre.z, data = df)
res.cox.no.30 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Grade: %.4f\n Biosensor measured miR-30d (pre-treatment): %.4f", anova(res.cox.no.grade,res.cox)$P[2], anova(res.cox.no.30,res.cox)$P[2]))
```
#### 4) Grade + Biosensor measured miR-486 (0 vs 6 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat+bio486.diff.z0.6, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Grade: %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.grade <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.diff.z0.6, data = df)
res.cox.no.486 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Grade: %.4f\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f", anova(res.cox.no.grade,res.cox)$P[2], anova(res.cox.no.486,res.cox)$P[2]))
```
#### 5) Grade + Biosensor measured miR-486 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat+bio486.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Grade: %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.grade <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post6.z, data = df)
res.cox.no.486 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Grade: %.4f\n Biosensor measured miR-486 (6 months' post-treatment): %.4f", anova(res.cox.no.grade,res.cox)$P[2], anova(res.cox.no.486,res.cox)$P[2]))
```
#### 6) Grade + Biosensor measured miR-21 (pre-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat+bio21.pre.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Grade: %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (pre-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.grade <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio21.pre.z, data = df)
res.cox.no.21 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Grade: %.4f\n Biosensor measured miR-21 (pre-treatment): %.4f", anova(res.cox.no.grade,res.cox)$P[2], anova(res.cox.no.21,res.cox)$P[2]))
```
#### 7) Biosensor measured miR-24 (6 months' post-treatment) + Biosensor measured miR-30d (pre-treatment) + Biosensor measured miR-21 (6 months’ post-treatment) + Biosensor measured miR-21 (pre-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z + bio30d.pre.z + bio21.post6.z + bio21.pre.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-30d (pre-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (6 months’ post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (pre-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4], summary(res.cox)$conf.int[4,1], summary(res.cox)$conf.int[4,3], summary(res.cox)$conf.int[4,4]))
res.cox.no.24 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio30d.pre.z + bio21.post6.z + bio21.pre.z, data = df)
res.cox.no.30d <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z + bio21.post6.z + bio21.pre.z, data = df)
res.cox.no.21p6 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z + bio30d.pre.z + bio21.pre.z, data = df)
res.cox.no.21pre <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z + bio30d.pre.z + bio21.post6.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f\n Biosensor measured miR-30d (pre-treatment): %.4f\n Biosensor measured miR-21 (6 months’ post-treatment): %.4f\n Biosensor measured miR-21 (pre-treatment): %.4f", anova(res.cox.no.24,res.cox)$P[2], anova(res.cox.no.30d,res.cox)$P[2], anova(res.cox.no.21p6,res.cox)$P[2], anova(res.cox.no.21pre,res.cox)$P[2]))
```
#### 8) Biosensor measured miR-24 (6 months' post-treatment) + Biosensor measured miR-30d (pre-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z + bio30d.pre.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-30d (pre-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.24 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio30d.pre.z, data = df)
res.cox.no.30d <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=40)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f\n Biosensor measured miR-30d (pre-treatment): %.4f", anova(res.cox.no.24,res.cox)$P[2], anova(res.cox.no.30d,res.cox)$P[2]))
```
# 3. Overall Survival analysis and recurrence analysis (continuous analysis of 12-months' post-treatment)
## Switch to 12-months' post-treatment data.
```{r, results='markup'}
df <- read.xls('./r_analysis_12mo.xlsx', sheet=2, na.strings=c("NA", "#DIV/0!"))
```
## Convert string formatted labels into numeric tags.
```{r, results='markup'}
df$gender_mat <- as.numeric(sub("F","0",sub("M","1",df$Gender)))
df$location_mat <- as.numeric(sub("Right","0",sub("Left","1",df$LATERAL)))
df$smoker_mat <- as.numeric(sub("Nonsmoker", "0", sub("Former","0", sub("Current","1",df$Smoker))))
df$grade_mat <- as.numeric(sub("Well differentiated", "1", sub("Moderately differentiated","1", sub("Poorly differentiated","0",df$Grade))))
df$status_mat <- as.numeric(sub("lost follow up", "0", sub("Alive","0", sub("Dead","1",df$Post.status))))
df$reoccur_status_mat <- as.numeric(sub("No","0",sub("Yes","1",df$Reoccur.status)))
df$reoccur_mat <- df$reoccur_status_mat
df$reoccur_mat[df$status_mat==1|df$reoccur_status_mat==1]=1
df$all <- 1
```
## Convert expressions of biomarkers into Z-scores.
```{r, results='markup'}
df$bio21.pre.z <- scale(df$Biosensor.miR.21.pre)
df$bio486.pre.z <- scale(df$Biosensor.miR.486.pre)
df$bio24.pre.z <- scale(df$Biosensor.miR.24.pre)
df$bio30d.pre.z <- scale(df$Biosensor.miR.30d.pre)
df$bio21.post6.z <- scale(df$Biosensor.miR.21.post.6.months)
df$bio486.post6.z <- scale(df$Biosensor.miR.486.post.6.months)
df$bio24.post6.z <- scale(df$Biosensor.miR.24.post.6.months)
df$bio30d.post6.z <- scale(df$Biosensor.miR.30d.post.6.months)
df$bio21.fc.z0.6 <- scale(log(df$Biosensor.miR.21.post.6.months/df$Biosensor.miR.21.pre,2))
df$bio486.fc.z0.6 <- scale(log(df$Biosensor.miR.486.post.6.months/df$Biosensor.miR.486.pre,2))
df$bio24.fc.z0.6 <- scale(log(df$Biosensor.miR.24.post.6.months/df$Biosensor.miR.24.pre,2))
df$bio30d.fc.z0.6 <- scale(log(df$Biosensor.miR.30d.post.6.months/df$Biosensor.miR.30d.pre,2))
df$bio21.diff.z0.6 <- scale(df$Biosensor.miR.21.post.6.months - df$Biosensor.miR.21.pre)
df$bio486.diff.z0.6 <- scale(df$Biosensor.miR.486.post.6.months - df$Biosensor.miR.486.pre)
df$bio24.diff.z0.6 <- scale(df$Biosensor.miR.24.post.6.months - df$Biosensor.miR.24.pre)
df$bio30d.diff.z0.6 <- scale(df$Biosensor.miR.30d.post.6.months - df$Biosensor.miR.30d.pre)
df$bio21.post12.z <- scale(df$Biosensor.miR.21.post.12.months)
df$bio486.post12.z <- scale(df$Biosensor.miR.486.post.12.months)
df$bio24.post12.z <- scale(df$Biosensor.miR.24.post.12.months)
df$bio30d.post12.z <- scale(df$Biosensor.miR.30d.post.12.months)
df$bio21.fc.z0.12 <- scale(log(df$Biosensor.miR.21.post.12.months/df$Biosensor.miR.21.pre,2))
df$bio486.fc.z0.12 <- scale(log(df$Biosensor.miR.486.post.12.months/df$Biosensor.miR.486.pre,2))
df$bio24.fc.z0.12 <- scale(log(df$Biosensor.miR.24.post.12.months/df$Biosensor.miR.24.pre,2))
df$bio30d.fc.z0.12 <- scale(log(df$Biosensor.miR.30d.post.12.months/df$Biosensor.miR.30d.pre,2))
df$bio21.fc.z6.12 <- scale(log(df$Biosensor.miR.21.post.12.months/df$Biosensor.miR.21.post.6.months,2))
df$bio486.fc.z6.12 <- scale(log(df$Biosensor.miR.486.post.12.months/df$Biosensor.miR.486.post.6.months,2))
df$bio24.fc.z6.12 <- scale(log(df$Biosensor.miR.24.post.12.months/df$Biosensor.miR.24.post.6.months,2))
df$bio30d.fc.z6.12 <- scale(log(df$Biosensor.miR.30d.post.12.months/df$Biosensor.miR.30d.post.6.months,2))
df$bio21.diff.z0.12 <- scale(df$Biosensor.miR.21.post.12.months - df$Biosensor.miR.21.pre)
df$bio486.diff.z0.12 <- scale(df$Biosensor.miR.486.post.12.months - df$Biosensor.miR.486.pre)
df$bio24.diff.z0.12 <- scale(df$Biosensor.miR.24.post.12.months - df$Biosensor.miR.24.pre)
df$bio30d.diff.z0.12 <- scale(df$Biosensor.miR.30d.post.12.months - df$Biosensor.miR.30d.pre)
df$bio21.diff.z6.12 <- scale(df$Biosensor.miR.21.post.12.months - df$Biosensor.miR.21.post.6.months)
df$bio486.diff.z6.12 <- scale(df$Biosensor.miR.486.post.12.months - df$Biosensor.miR.486.post.6.months)
df$bio24.diff.z6.12 <- scale(df$Biosensor.miR.24.post.12.months - df$Biosensor.miR.24.post.6.months)
df$bio30d.diff.z6.12 <- scale(df$Biosensor.miR.30d.post.12.months - df$Biosensor.miR.30d.post.6.months)

df$pcr21.pre.z <- scale(-df$qPCR.miR.21.pre)
df$pcr486.pre.z <- scale(-df$qPCR.miR.486.pre)
df$pcr24.pre.z <- scale(-df$qPCR.miR.24.pre)
df$pcr30d.pre.z <- scale(-df$qPCR.miR.30d.pre)
df$pcr21.post6.z <- scale(-df$qPCR.miR.21.post.6.months)
df$pcr486.post6.z <- scale(-df$qPCR.miR.486.post.6.months)
df$pcr24.post6.z <- scale(-df$qPCR.miR.24.post.6.months)
df$pcr30d.post6.z <- scale(-df$qPCR.miR.30d.post.6.months)
df$pcr21.diff.z0.6 <- scale(df$qPCR.miR.21.pre - df$qPCR.miR.21.post.6.months)
df$pcr486.diff.z0.6 <- scale(df$qPCR.miR.486.pre - df$qPCR.miR.486.post.6.months)
df$pcr24.diff.z0.6 <- scale(df$qPCR.miR.24.pre - df$qPCR.miR.24.post.6.months)
df$pcr30d.diff.z0.6 <- scale(df$qPCR.miR.30d.pre - df$qPCR.miR.30d.post.6.months)
df$pcr21.post12.z <- scale(-df$qPCR.miR.21.post.12.months)
df$pcr486.post12.z <- scale(-df$qPCR.miR.486.post.12.months)
df$pcr24.post12.z <- scale(-df$qPCR.miR.24.post.12.months)
df$pcr30d.post12.z <- scale(-df$qPCR.miR.30d.post.12.months)
df$pcr21.diff.z0.12 <- scale(df$qPCR.miR.21.pre - df$qPCR.miR.21.post.12.months)
df$pcr486.diff.z0.12 <- scale(df$qPCR.miR.486.pre - df$qPCR.miR.486.post.12.months)
df$pcr24.diff.z0.12 <- scale(df$qPCR.miR.24.pre - df$qPCR.miR.24.post.12.months)
df$pcr30d.diff.z0.12 <- scale(df$qPCR.miR.30d.pre - df$qPCR.miR.30d.post.12.months)
df$pcr21.diff.z6.12 <- scale(df$qPCR.miR.21.post.6.months - df$qPCR.miR.21.post.12.months)
df$pcr486.diff.z6.12 <- scale(df$qPCR.miR.486.post.6.months - df$qPCR.miR.486.post.12.months)
df$pcr24.diff.z6.12 <- scale(df$qPCR.miR.24.post.6.months - df$qPCR.miR.24.post.12.months)
df$pcr30d.diff.z6.12 <- scale(df$qPCR.miR.30d.post.6.months - df$qPCR.miR.30d.post.12.months)
```
## Check the covariance matrix.
```{r, results='markup'}
cov <- var(df[c('bio21.pre.z', 'bio21.post6.z', 'bio486.pre.z', 'bio486.post6.z', 'bio24.pre.z', 'bio24.post6.z', 'bio30d.pre.z', 'bio30d.post6.z', 'bio21.diff.z0.6', 'bio486.diff.z0.6', 'bio24.diff.z0.6', 'bio30d.diff.z0.6', 'bio21.fc.z0.6', 'bio486.fc.z0.6', 'bio24.fc.z0.6', 'bio30d.fc.z0.6', 'bio21.post12.z', 'bio486.post12.z', 'bio24.post12.z', 'bio30d.post12.z', 'bio21.diff.z0.12', 'bio21.diff.z6.12', 'bio486.diff.z0.12', 'bio486.diff.z6.12', 'bio24.diff.z0.12', 'bio24.diff.z6.12', 'bio30d.diff.z0.12', 'bio30d.diff.z6.12', 'bio21.fc.z0.12', 'bio21.fc.z6.12', 'bio486.fc.z0.12', 'bio486.fc.z6.12', 'bio24.fc.z0.12', 'bio24.fc.z6.12', 'bio30d.fc.z0.12', 'bio30d.fc.z6.12')])
cov
```
## 3.1. Overall Survival analysis
### 3.1.1. Univariate analysis of Biomarkers
#### Overall survival
```{r, results='markup'}
sfit <- survfit(Surv(df$survival, df$status_mat==1) ~ all, data = df)
sprintf("5-Year Survival %% (95%% CI): %.4f (%.4f, %.4f)", summary(sfit, times=60)$surv[1], summary(sfit, times=60)$lower[1], summary(sfit, times=60)$upper[1])
```
#### Validate previous analysis
##### Clinical characteristics
```{r, results='markup'}
variates <- c('gender_mat', 'smoker_mat', 'grade_mat', 'location_mat', 
             'Age.at.surgery', 'Largest.dimension..cm.')
discrete <- c(TRUE, TRUE, TRUE, TRUE, FALSE, FALSE)
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
survr.5yr <- vector()
for(i in 1:length(variates)) {
  res <- unianalysis(variates[i], 'survival', discrete=discrete[i])
  p.value <- res[1]
  hr <- paste0(round(res[2],2), '(', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
  if (discrete[i]) {
    surv.rate <- paste0('Ref: ', round(res[5],5), ' (', round(res[6],5), ', ', round(res[7],5), '); ', 
                        'Exp: ', round(res[8],5), ' (', round(res[9],5), ', ', round(res[10],5), '). ')
  } else {
    surv.rate <- 'NA'
  }
  survr.5yr <- c(survr.5yr, surv.rate)
}
results <- data.frame(variates, p.values, hr.strs, survr.5yr, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs', 'survr.5yr')]
```
##### Biomarkers
```{r, results='markup'}
variates = c('bio21.pre.z', 'bio21.post6.z', 'bio486.pre.z', 'bio486.post6.z', 
             'bio24.pre.z', 'bio24.post6.z', 'bio30d.pre.z', 'bio30d.post6.z', 
             'pcr21.pre.z', 'pcr21.post6.z', 'pcr486.pre.z', 'pcr486.post6.z', 
             'pcr24.pre.z', 'pcr24.post6.z', 'pcr30d.pre.z', 'pcr30d.post6.z',
             'bio21.fc.z0.6', 'bio486.fc.z0.6', 'bio24.fc.z0.6', 'bio30d.fc.z0.6',
             'pcr21.diff.z0.6', 'pcr486.diff.z0.6', 'pcr24.diff.z0.6', 'pcr30d.diff.z0.6',
             'bio21.diff.z0.6', 'bio486.diff.z0.6', 'bio24.diff.z0.6', 'bio30d.diff.z0.6')
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
for(variate in variates) {
  res <- unianalysis(variate, 'survival')
  p.value <- res[1]
  hr <- paste0(round(res[2],2), ' (', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
}
results <- data.frame(variates, p.values, hr.strs, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs')]
```
##### Analyzing 12-months' post-treatment data.
```{r, results='markup'}
variates = c('bio21.post12.z', 'bio486.post12.z', 'bio24.post12.z', 'bio30d.post12.z', 
             'bio21.fc.z0.12', 'bio21.fc.z6.12', 'bio486.fc.z0.12', 'bio486.fc.z6.12', 
             'bio24.fc.z0.12', 'bio24.fc.z6.12', 'bio30d.fc.z0.12', 'bio30d.fc.z6.12',
             'pcr21.post12.z', 'pcr486.post12.z', 'pcr24.post12.z', 'pcr30d.post12.z', 
             'pcr21.diff.z0.12', 'pcr21.diff.z6.12', 'pcr486.diff.z0.12', 'pcr486.diff.z6.12', 
             'pcr24.diff.z0.12', 'pcr24.diff.z6.12', 'pcr30d.diff.z0.12', 'pcr30d.diff.z6.12',
             'bio21.diff.z0.12', 'bio21.diff.z6.12', 'bio486.diff.z0.12', 'bio486.diff.z6.12', 
             'bio24.diff.z0.12', 'bio24.diff.z6.12', 'bio30d.diff.z0.12', 'bio30d.diff.z6.12')
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
for(variate in variates) {
  res <- unianalysis(variate, 'survival')
  p.value <- res[1]
  hr <- paste0(round(res[2],2), ' (', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
}
results <- data.frame(variates, p.values, hr.strs, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs')]
```
### 3.1.2. Multivariate analysis
#### Biosensor measured miR-486 (12 months' post-treatment) + Biosensor measured miR-24 (6 vs 12 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ bio486.post12.z+bio24.diff.z6.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.486.post12 <- coxph(Surv(df$survival, df$status_mat) ~ bio24.diff.z6.12, data = df)
res.cox.no.24.6.12 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.post12.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f", anova(res.cox.no.486.post12,res.cox)$P[2], anova(res.cox.no.24.6.12,res.cox)$P[2]))
```
#### Validate previous models.
##### 1) Smoking status + Biosensor measured miR-486 (0 vs 6 months differentiated expressions) + Biosensor measured miR-24 (6 months’ post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio486.diff.z0.6+bio24.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 months’ post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio24.post6.z, data = df)
res.cox.no.486.0.6 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio24.post6.z, data = df)
res.cox.no.24 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio486.diff.z0.6, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Smoking status: %.4f\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f\n Biosensor measured miR-24 (6 months’ post-treatment): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.486.0.6,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
##### 2) Biosensor measured miR-486 (0 vs 6 months differentiated expressions) + Biosensor measured miR-24 (6 months’ post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio24.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 months’ post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.486.0.6 <- coxph(Surv(df$survival, df$status_mat) ~ bio24.post6.z, data = df)
res.cox.no.24 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f\n Biosensor measured miR-24 (6 months’ post-treatment): %.4f", anova(res.cox.no.486.0.6,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
#### Compare the previous selection with the current ones.
##### 1) Biosensor measured miR-486 (0 vs 6 months differentiated expressions) + Biosensor measured miR-486 (12 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio486.post12.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.486.0.6 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.post12.z, data = df)
res.cox.no.486.post12 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f\n Biosensor measured miR-486 (12 months' post-treatment): %.4f", anova(res.cox.no.486.0.6,res.cox)$P[2], anova(res.cox.no.486.post12,res.cox)$P[2]))
```
##### 2) Biosensor measured miR-486 (0 vs 6 months differentiated expressions) + Biosensor measured miR-486 (12 months' post-treatment) + Biosensor measured miR-24 (6 vs 12 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio486.post12.z+bio24.diff.z6.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.486.0.6 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.post12.z+bio24.diff.z6.12, data = df)
res.cox.no.486.post12 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio24.diff.z6.12, data = df)
res.cox.no.24 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio486.post12.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f\n Biosensor measured miR-486 (12 months' post-treatment): %.4f\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f", anova(res.cox.no.486.0.6,res.cox)$P[2], anova(res.cox.no.486.post12,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
##### 3) Biosensor measured miR-24 (6 months' post-treatment) + Biosensor measured miR-24 (6 vs 12 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ bio24.post6.z+bio24.diff.z6.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-24 (6 months’ post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.24.post6 <- coxph(Surv(df$survival, df$status_mat) ~ bio24.diff.z6.12, data = df)
res.cox.no.24.6.12 <- coxph(Surv(df$survival, df$status_mat) ~ bio24.post6.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-24 (6 months’ post-treatment): %.4f\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f", anova(res.cox.no.24.post6,res.cox)$P[2], anova(res.cox.no.24.6.12,res.cox)$P[2]))
```
##### 4) Biosensor measured miR-486 (12 months' post-treatment) + Biosensor measured miR-24 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ bio486.post12.z+bio24.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.486.post12 <- coxph(Surv(df$survival, df$status_mat) ~ bio24.post6.z, data = df)
res.cox.no.24 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.post12.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f\n Biosensor measured miR-24 (6 months' post-treatment): %.4f", anova(res.cox.no.486.post12,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
#### Other selections.
##### 1) Smoking status + Biosensor measured miR-486 (0 vs 6 months differentiated expressions) + Biosensor measured miR-24 (6 vs 12 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio486.diff.z0.6+bio24.diff.z6.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Smoking status: %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.smoke <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio24.diff.z6.12, data = df)
res.cox.no.486.0.6 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio24.diff.z6.12, data = df)
res.cox.no.24.6.12 <- coxph(Surv(df$survival, df$status_mat) ~ smoker_mat+bio486.diff.z0.6, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Smoking status: %.4f\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f", anova(res.cox.no.smoke,res.cox)$P[2], anova(res.cox.no.486.0.6,res.cox)$P[2], anova(res.cox.no.24.6.12,res.cox)$P[2]))
```
##### 2) Biosensor measured miR-486 (0 vs 6 months differentiated expressions) + Biosensor measured miR-24 (6 vs 12 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6+bio24.diff.z6.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.486.0.6 <- coxph(Surv(df$survival, df$status_mat) ~ bio24.diff.z6.12, data = df)
res.cox.no.24.6.12 <- coxph(Surv(df$survival, df$status_mat) ~ bio486.diff.z0.6, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-486 (0 vs 6 months differentiated expressions): %.4f\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f", anova(res.cox.no.486.0.6,res.cox)$P[2], anova(res.cox.no.24.6.12,res.cox)$P[2]))
```
## 3.2. Recurrence analysis
### 3.2.1. Univariate analysis
#### Overall survival
```{r, results='markup'}
sfit <- survfit(Surv(df$recurrence, df$reoccur_mat==1) ~ all, data = df)
sprintf("5-Year Survival %% (95%% CI): %.4f (%.4f, %.4f)", summary(sfit, times=60)$surv[1], summary(sfit, times=60)$lower[1], summary(sfit, times=60)$upper[1])
```
#### Validate previous analysis
##### Clinical characteristics
```{r, results='markup'}
variates <- c('gender_mat', 'smoker_mat', 'grade_mat', 'location_mat', 
             'Age.at.surgery', 'Largest.dimension..cm.')
discrete <- c(TRUE, TRUE, TRUE, TRUE, FALSE, FALSE)
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
survr.5yr <- vector()
for(i in 1:length(variates)) {
  res <- unianalysis(variates[i], 'recurrence', discrete=discrete[i])
  p.value <- res[1]
  hr <- paste0(round(res[2],2), ' (', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
  if (discrete[i]) {
    surv.rate <- paste0('Ref: ', round(res[5],5), ' (', round(res[6],5), ', ', round(res[7],5), '); ', 
                        'Exp: ', round(res[8],5), ' (', round(res[9],5), ', ', round(res[10],5), '). ')
  } else {
    surv.rate <- 'NA'
  }
  survr.5yr <- c(survr.5yr, surv.rate)
}
results <- data.frame(variates, p.values, hr.strs, survr.5yr, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs', 'survr.5yr')]
```
##### Biomarkers
```{r, results='markup'}
variates = c('bio21.pre.z', 'bio21.post6.z', 'bio486.pre.z', 'bio486.post6.z', 
             'bio24.pre.z', 'bio24.post6.z', 'bio30d.pre.z', 'bio30d.post6.z', 
             'pcr21.pre.z', 'pcr21.post6.z', 'pcr486.pre.z', 'pcr486.post6.z', 
             'pcr24.pre.z', 'pcr24.post6.z', 'pcr30d.pre.z', 'pcr30d.post6.z',
             'bio21.fc.z0.6', 'bio486.fc.z0.6', 'bio24.fc.z0.6', 'bio30d.fc.z0.6',
             'pcr21.diff.z0.6', 'pcr486.diff.z0.6', 'pcr24.diff.z0.6', 'pcr30d.diff.z0.6',
             'bio21.diff.z0.6', 'bio486.diff.z0.6', 'bio24.diff.z0.6', 'bio30d.diff.z0.6')
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
for(variate in variates) {
  res <- unianalysis(variate, 'recurrence')
  p.value <- res[1]
  hr <- paste0(round(res[2],2), ' (', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
}
results <- data.frame(variates, p.values, hr.strs, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs')]
```
##### Analyzing 12-months' post-treatment data.
```{r, results='markup'}
variates = c('bio21.post12.z', 'bio486.post12.z', 'bio24.post12.z', 'bio30d.post12.z', 
             'bio21.fc.z0.12', 'bio21.fc.z6.12', 'bio486.fc.z0.12', 'bio486.fc.z6.12', 
             'bio24.fc.z0.12', 'bio24.fc.z6.12', 'bio30d.fc.z0.12', 'bio30d.fc.z6.12',
             'pcr21.post12.z', 'pcr486.post12.z', 'pcr24.post12.z', 'pcr30d.post12.z', 
             'pcr21.diff.z0.12', 'pcr21.diff.z6.12', 'pcr486.diff.z0.12', 'pcr486.diff.z6.12', 
             'pcr24.diff.z0.12', 'pcr24.diff.z6.12', 'pcr30d.diff.z0.12', 'pcr30d.diff.z6.12',
             'bio21.diff.z0.12', 'bio21.diff.z6.12', 'bio486.diff.z0.12', 'bio486.diff.z6.12', 
             'bio24.diff.z0.12', 'bio24.diff.z6.12', 'bio30d.diff.z0.12', 'bio30d.diff.z6.12')
p.values <- vector()
hr.strs <- vector()
hr.value <- vector()
hr.lower <- vector()
hr.upper <- vector()
for(variate in variates) {
  res <- unianalysis(variate, 'recurrence')
  p.value <- res[1]
  hr <- paste0(round(res[2],2), ' (', round(res[3], 2), ', ', round(res[4], 2), ')')
  p.values <- c(p.values, round(p.value, 4))
  hr.strs <- c(hr.strs, hr)
  hr.value <- c(hr.value, res[2])
  hr.lower <- c(hr.lower, res[3])
  hr.upper <- c(hr.upper, res[4])
}
results <- data.frame(variates, p.values, hr.strs, hr.value, hr.lower, hr.upper)
results[,c('variates', 'p.values', 'hr.strs')]
```
### 3.2.2. Multivariate analysis
#### Biosensor measured miR-486 (12 months' post-treatment) + Biosensor measured miR-21 (0 vs 12 months differentiated expressions) + Biosensor measured miR-24 (6 vs 12 months differentiated expressions)
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z+bio21.diff.z0.12+bio24.diff.z6.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.486.post12 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio21.diff.z0.12, data = df)
res.cox.no.21.diff.0.12 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio486.post12.z, data = df)
res.cox.no.24.post6 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z+bio21.diff.z0.12, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions): %.4f\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f", anova(res.cox.no.486.post12,res.cox)$P[2], anova(res.cox.no.21.diff.0.12,res.cox)$P[2], anova(res.cox.no.24.post6,res.cox)$P[2]))
```
#### Biosensor measured miR-24 (6 vs 12 months differentiated expressions) + Biosensor measured miR-21 (0 vs 12 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.diff.z6.12+bio21.diff.z0.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions).: %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.24 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio21.diff.z0.12, data = df)
res.cox.no.21 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.diff.z6.12, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions).: %.4f", anova(res.cox.no.24,res.cox)$P[2], anova(res.cox.no.21,res.cox)$P[2]))
```
#### Biosensor measured miR-486 (12 months' post-treatment) + Biosensor measured miR-21 (0 vs 12 months differentiated expressions)
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z+bio21.diff.z0.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.486.post12 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio21.diff.z0.12, data = df)
res.cox.no.21.diff.0.12 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions): %.4f", anova(res.cox.no.486.post12,res.cox)$P[2], anova(res.cox.no.21.diff.0.12,res.cox)$P[2]))
```
#### Biosensor measured miR-486 (12 months' post-treatment) + Biosensor measured miR-24 (6 vs 12 months differentiated expressions)
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z+bio24.diff.z6.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.486.post12 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z, data = df)
res.cox.no.24.post6 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f\n Biosensor measured miR-24 (6 vs 12 months differentiated expressions): %.4f", anova(res.cox.no.486.post12,res.cox)$P[2], anova(res.cox.no.24.post6,res.cox)$P[2]))
```
#### Validate previous models.
##### 1) Grade + Biosensor measured miR-24 (6 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat+bio24.post6.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Grade: %.4f (%.4f, %.4f)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.grade <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z, data = df)
res.cox.no.24 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Grade: %.4f\n Biosensor measured miR-24 (6 months' post-treatment): %.4f", anova(res.cox.no.grade,res.cox)$P[2], anova(res.cox.no.24,res.cox)$P[2]))
```
#### Compare the previous selection with the current ones.
##### 1) Biosensor measured miR-24 (6 months' post-treatment) + Biosensor measured miR-486 (12 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio486.post12.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.24 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z, data = df)
res.cox.no.486 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f\n Biosensor measured miR-486 (12 months' post-treatment): %.4f", anova(res.cox.no.24,res.cox)$P[2], anova(res.cox.no.486,res.cox)$P[2]))
```
##### 2) Biosensor measured miR-24 (6 months' post-treatment) + Biosensor measured miR-486 (12 months' post-treatment) + Biosensor measured miR-21 (0 vs 12 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio486.post12.z+bio21.diff.z0.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.24.post6 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z+bio21.diff.z0.12, data = df)
res.cox.no.486.post12 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio21.diff.z0.12, data = df)
res.cox.no.21.diff.0.12 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio486.post12.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f\n Biosensor measured miR-486 (12 months' post-treatment): %.4f\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions): %.4f", anova(res.cox.no.24.post6,res.cox)$P[2], anova(res.cox.no.486.post12,res.cox)$P[2], anova(res.cox.no.21.diff.0.12,res.cox)$P[2]))
```
#### Other selections
##### 1) Grade + Biosensor measured miR-486 (12 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat+bio486.post12.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Grade: %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.grade <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z, data = df)
res.cox.no.486 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ grade_mat, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Grade: %.4f\n Biosensor measured miR-486 (12 months' post-treatment): %.4f", anova(res.cox.no.grade,res.cox)$P[2], anova(res.cox.no.486,res.cox)$P[2]))
```
##### 2) Biosensor measured miR-24 (6 months' post-treatment) + Biosensor measured miR-486 (12 months' post-treatment) + Biosensor measured miR-21 (12 months' post-treatment).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio486.post12.z+bio21.post12.z, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-486 (12 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (12 months' post-treatment): %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4], summary(res.cox)$conf.int[3,1], summary(res.cox)$conf.int[3,3], summary(res.cox)$conf.int[3,4]))
res.cox.no.24.post6 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio486.post12.z+bio21.post12.z, data = df)
res.cox.no.486.post12 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio21.post12.z, data = df)
res.cox.no.21.post12 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio486.post12.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f\n Biosensor measured miR-486 (12 months' post-treatment): %.4f\n Biosensor measured miR-21 (12 months' post-treatment): %.4f", anova(res.cox.no.24.post6,res.cox)$P[2], anova(res.cox.no.486.post12,res.cox)$P[2], anova(res.cox.no.21.post12,res.cox)$P[2]))
```
##### 3) Biosensor measured miR-24 (6 months' post-treatment) + Biosensor measured miR-21 (0 vs 12 months differentiated expressions).
```{r, results='markup'}
res.cox <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z+bio21.diff.z0.12, data = df)
sprintf("Overall log-rank p-value of the multivariate model is %.4f.", summary(res.cox)$sctest[3])
cat(sprintf("Cox Multivariate Hazard Ratio (95%% CI)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f (%.4f, %.4f)\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions).: %.4f (%.4f, %.4f)", summary(res.cox)$conf.int[1,1], summary(res.cox)$conf.int[1,3], summary(res.cox)$conf.int[1,4], summary(res.cox)$conf.int[2,1], summary(res.cox)$conf.int[2,3], summary(res.cox)$conf.int[2,4]))
res.cox.no.24.post6 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio21.diff.z0.12, data = df)
res.cox.no.21 <- coxph(Surv(df$recurrence, df$reoccur_mat) ~ bio24.post6.z, data = df)
cat(sprintf("Cox Multivariate Likelihood Ratio p-value (n=21)\n Biosensor measured miR-24 (6 months' post-treatment): %.4f\n Biosensor measured miR-21 (0 vs 12 months differentiated expressions).: %.4f", anova(res.cox.no.24.post6,res.cox)$P[2], anova(res.cox.no.21,res.cox)$P[2]))
```